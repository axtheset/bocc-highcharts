<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Charlotte County Test Data</title>

    The Styles
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://netdna.bootstrapcdn.com/bootswatch/3.1.1/cerulean/bootstrap.min.css" rel="stylesheet">
        <link href="assets/jquery.dataTables.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="assets/c3.css">
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Testing Permitting Home Information</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="about.html">About</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

    <div class="container theme-showcase" role="main">

      <div class="page-header">
        <h1>Workflow Query</h1>
        <h4>Test Query</h4>
      </div>

      <div id="chart"></div>
      

      <div class="page-header">
        <h1>Joing Resource in CivicData.io</h1>
      </div>
      <p><a href="http://www.civicdata.io/en/home">CivicData.io</a>'s SQL Search API lets you execute SQL statements against datasets, and even combine them with SQL joins. This makes it possible to run queries across different data sets and mash up data in new and intersting ways.</p>
      <p>The chart above was generated by querying two different data sets in CivicData.io. To see the raw JSON resonse for the SQL query below, click <a href="http://www.civicdata.com/api/action/datastore_search_sql?sql=SELECT%20%22ac4a59ea-bf90-4623-9d41-9046875171b2%22.%22OccurrencePrecinctCode%22%20AS%20%22Precinct%20Code%22,%20COUNT(%22ac4a59ea-bf90-4623-9d41-9046875171b2%22.%22CollisionID%22)%20AS%20%22Num%20Accidents%20where%20factors%20reported%22%20from%20%22ac4a59ea-bf90-4623-9d41-9046875171b2%22,%20%22f5795be2-ac78-4580-b831-3df42842071c%22%20WHERE%20%22ac4a59ea-bf90-4623-9d41-9046875171b2%22.%22CollisionID%22%20=%20%22f5795be2-ac78-4580-b831-3df42842071c%22.%22CollisionID%22%20AND%20%22f5795be2-ac78-4580-b831-3df42842071c%22.%22ContributingFactorCode%22%20IS%20NOT%20NULL%20GROUP%20BY%20%22ac4a59ea-bf90-4623-9d41-9046875171b2%22.%22OccurrencePrecinctCode%22%20ORDER%20BY%20%22Num%20Accidents%20where%20factors%20reported%22%20DESC">here</a>.</p>
      <div class="well">
        <pre>
    SELECT "ac4a59ea-bf90-4623-9d41-9046875171b2"."OccurrencePrecinctCode" AS "Precinct Code", 
    COUNT("ac4a59ea-bf90-4623-9d41-9046875171b2"."CollisionID") AS "Num Accidents where factors reported"
    from  "ac4a59ea-bf90-4623-9d41-9046875171b2", "f5795be2-ac78-4580-b831-3df42842071c"
    WHERE "ac4a59ea-bf90-4623-9d41-9046875171b2"."CollisionID" = "f5795be2-ac78-4580-b831-3df42842071c"."CollisionID"
    AND "f5795be2-ac78-4580-b831-3df42842071c"."ContributingFactorCode" IS NOT NULL
    GROUP BY "ac4a59ea-bf90-4623-9d41-9046875171b2"."OccurrencePrecinctCode"
    ORDER BY "Num Accidents where factors reported" DESC
        </pre>
      </div>
      <div id="container" style="height:400px;"></div>
<table id="example">
	<thead>
	<tr>
<!--	<th>Date Opened</th>
	<th>Record Type Group</th>
	<th>Record Type Subtype</th>
	<th>Record Type Category</th>
	<th>Business Name</th>
	<th>Record Type</th> -->
	<th>Record Type</th> 
	<th>Count</th>
	</tr>
	</thead>
</table>


    </div> <!-- /container -->


    <!-- Le JavaScripts-->
    <script src="assets/jquery-1.7.2.min.js"></script>
    <script src="assets/jquery.dynatable.js"></script>
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="assets/c3.min.js"></script>
    <script src="assets/jquery.dataTables.min.js"></script>
	<script src="assets/js/highcharts.js"></script>
	<script src="assets/js/highcharts-3d.js"></script>
	<script src="assets/js/modules/exporting.js"></script>
    <script type="text/javascript">
		$(function () {
			$('#container').highcharts({
				chart: {
					type: 'pie',
					options3d: {
						enabled: true;
						alpha: 45,
						beta: 0
					}
				},
				title: {
					text: 'Test Chart'
				},
				tooltip: {
					pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
				},
				plotOptions: {
					pie: {
						allowPointSelect: true,
						cursor: 'pointer',
						depth: 35,
						dataLabels: {
							enabled: true,
							format: '{point.name}'
						}
					}
				},
		        series: [{
		            type: 'pie',
		            name: 'Browser share',
		            data: [
		                ['Firefox',   45.0],
		                ['IE',       26.8],
		                {
		                    name: 'Chrome',
		                    y: 12.8,
		                    sliced: true,
		                    selected: true
		                },
		                ['Safari',    8.5],
		                ['Opera',     6.2],
		                ['Others',   0.7]
		            ]
		        }]
		    });
		});

/*      $(document).ready(function() {
         
		$.ajaxSetup({cache:false});
		var testUrl = 'http://www.civicdata.com/api/action/datastore_search_sql?sql=SELECT "RECORD TYPE SUBTYPE" as RecordType, count(*) as Count FROM "92c62bd0-64ea-48ed-b28b-6976fba03cde" group by RecordType order by Count desc'
//		var testUrl = 'http://www.civicdata.com/api/action/datastore_search_sql?sql=SELECT%20DISTINCT%20%22WORKFLOW%20TASK%22,%20%22WORKFLOW%20TASK%20STATUS%22%20from%20%220a6d4715-653c-4ba5-9369-8b74ff872d94%22%20%20where%20%22WORKFLOW%20TASK%20STATUS%22%20%3C%3E%20%27Rejected%27%20order%20by%20%22WORKFLOW%20TASK%22,%20%22WORKFLOW%20TASK%20STATUS%22';
//		var testUrl = 'http://www.civicdata.com/api/action/datastore_search_sql?sql=SELECT * FROM %22163d8400-3ffd-4739-82c9-8c2f58ecd923%22 WHERE %22RECORD TYPE CATEGORY%22 = %27Remodel%27';
//		var testUrl = 'http://www.civicdata.com/api/action/datastore_search_sql?sql=SELECT%20*%20FROM%20%22163d8400-3ffd-4739-82c9-8c2f58ecd923%22';
	    $('#example').dataTable( {
//        	"processing": true,
        	"ajax": {
        		"url": testUrl,
        		"deferRender": true,
        		"dataSrc": function(json) {
        			var recordTest = json.result.records;
        			return recordTest;
        		}

        	},
        	"columns": [
        		{ "data": "RecordType" },
        		{ "data": "Count" }
//        		{ "data": "DATE OPENED" },
//        		{ "data": "RECORD TYPE GROUP" },
//				{ "data": "RECORD TYPE SUBTYPE" },
//				{ "data": "RECORD TYPE CATEGORY" },
//				{ "data": "BUSINESS NAME" },
//				{ "data": "RECORD TYPE" }
	        ]
	    } );

        // Helper function to make request for JSONP.
        function requestJSON(url, callback) {
          $.ajax({
            url: testUrl,
            complete: function(xhr) {
              callback.call(null, xhr.responseJSON);
            }
          });
        }
/*
        // Make API call and format results.
        requestJSON(url, function(json) {
          var records = json.result.records
          var counts = [];
          for(var i=0; i<records.length; i++) {
            suppLinks.append(records);
          }

            // Draw the bar chart.
            var chart = c3.generate({
              bindto: '#chart',
              data: {
                  columns: counts,
                  type: 'bar',
                  labels: true
              },
              bar: {
                  width: {
                      ratio: 1.0 
                  }
              },
              legend: {
                  position: 'right'
              },
              tooltip: {
                  show: false
              }
          });

        });

      });
*/
    </script>
  </body>
</html>